---
title: "E-Book Subject Analysis"
output: github_document
---

```{r message = FALSE}
# load libraries
library(tidyverse)
```

```{r}
# import and combine vendor usage files
files <- dir(path = "./usage-stats", full.names = TRUE)
headers <- c("title", "publisher", "publisher_id", "platform", "doi", 
                "proprietary_id", "isbn", "print_issn", "online_issn", "uri", 
                "data_type", "section_type", "yop", "access_type", 
                "access_method","metric_type", "total")

tr <- files %>%
  map(read_csv, skip = 14, col_select = 1:17, col_names = headers, 
      col_type = "cccccccccccciccci") %>%
  reduce(bind_rows)
```

```{r}
# filter tr to include book format and relevant metrics
tr_books <- tr %>%
  filter(data_type == "Book") %>%
  filter(metric_type %in% c("Unique_Title_Requests", "No_License", "Limit_Exceeded"))
```

```{r}
# create list of unique isbns
tr_books <- tr_books %>%
  mutate(isbn_norm = str_remove_all(isbn, "-"))

unique_isbn <- tr_books %>%
  select(isbn_norm) %>%
  distinct(isbn_norm)

n_distinct(unique_isbn)
```

